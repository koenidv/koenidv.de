---
import { getCollection } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';

// Make this page prerendered
export const prerender = true;

// Generate static paths for all articles
export async function getStaticPaths() {
  const articleEntries = await getCollection('articles', ({ data }) => {
    // Only include published articles
    return data.published !== false && data.draft !== true;
  });
  
  return articleEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

// Get the article data from the props
const { entry } = Astro.props;
// Render the article content
const { Content } = await entry.render();

// Format the date
const formattedDate = entry.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Define category colors for visual distinction
const categoryColors = {
  "reverse-eng": "bg-amber-100 text-amber-800 border-amber-200",
  "android": "bg-green-100 text-green-800 border-green-200",
  "hardware": "bg-red-100 text-red-800 border-red-200",
  "web": "bg-blue-100 text-blue-800 border-blue-200"
};
---

<BlogLayout 
  title={entry.data.title}
  description={entry.data.description}
>
  <article class="max-w-3xl mx-auto px-4 py-12 font-mono">
    <!-- Article Header -->
    <header class="mb-10">
      <div class="flex items-center gap-3 mb-4">
        <span class={`text-sm px-3 py-1 rounded-md border ${categoryColors[entry.data.category]}`}>
          {entry.data.category}
        </span>
        <time class="text-gray-500 text-sm">
          {formattedDate}
        </time>
      </div>
      
      <h1 class="text-4xl font-bold mb-6 leading-tight">
        {entry.data.title}
      </h1>
      
      <p class="text-xl text-gray-600 mb-8">
        {entry.data.description}
      </p>
    </header>
    
    <!-- Featured Image -->
    {entry.data.image && (
      <div class="mb-10 rounded-lg overflow-hidden shadow-md">
        <img 
          src={entry.data.image} 
          alt={entry.data.title}
          class="w-full h-auto object-cover"
        />
      </div>
    )}
    
    <!-- Article Content -->
    <div class="prose prose-slate max-w-none font-mono prose-headings:font-bold prose-headings:border-b prose-headings:pb-2 prose-headings:border-gray-200 prose-pre:bg-gray-800 prose-pre:text-gray-100 prose-pre:rounded-md prose-pre:shadow-inner prose-code:text-blue-600 prose-code:bg-blue-50 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none">
      <Content />
    </div>
    
    <!-- Article Footer -->
    <footer class="mt-16 pt-8 border-t border-gray-200">
      <div class="flex justify-between items-center">
        <a href="/blog" class="inline-flex items-center text-blue-600 hover:text-blue-800">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
          Back to all articles
        </a>
        
        <div class="flex space-x-4">
          <button 
            class="text-gray-500 hover:text-blue-500 copy-link-btn"
            data-url={`https://koeni.dev/blog/${entry.slug}`}
            aria-label="Copy link to article"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </footer>
  </article>
</BlogLayout>

<script>
  // Script to handle the copy link button
  document.addEventListener('DOMContentLoaded', () => {
    const copyBtn = document.querySelector('.copy-link-btn');
    if (copyBtn) {
      copyBtn.addEventListener('click', () => {
        const url = copyBtn.getAttribute('data-url');
        navigator.clipboard.writeText(url).then(() => {
          // Optional: Show a tooltip or notification that the link was copied
          const originalText = copyBtn.innerHTML;
          copyBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
          `;
          
          setTimeout(() => {
            copyBtn.innerHTML = originalText;
          }, 2000);
        });
      });
    }
  });
</script>
