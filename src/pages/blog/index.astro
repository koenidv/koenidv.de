---
import BlogLayout from '../../layouts/BlogLayout.astro';
import { getCollection } from 'astro:content';

// Make this page prerendered
export const prerender = true;

// Get all articles from the collection
const allArticles = await getCollection('articles', ({ data }) => {
  // Only show published articles (not drafts)
  return data.published !== false && data.draft !== true;
});

// Sort articles by date (newest first)
const sortedArticles = allArticles.sort((a, b) => 
  b.data.date.getTime() - a.data.date.getTime()
);

// Define category colors for visual distinction
const categoryColors = {
  "reverse-eng": "bg-amber-100 text-amber-800",
  "android": "bg-green-100 text-green-800",
  "hardware": "bg-red-100 text-red-800",
  "web": "bg-blue-100 text-blue-800"
};
---

<BlogLayout
  title="Florian König's Technology Blog"
  description="Articles on tech and design by Florian König."
>
  <div class="max-w-7xl mx-auto py-8">
    <h1 class="text-4xl font-black font-poppins tracking-wider mb-8 pb-4">Articles</h1>
    
    <div class="grid gap-8 md:grid-cols-2">
      {sortedArticles.map((article) => (
        <div class="group flex w-full">
	<a class="elevated-card-hoverable hover:cursor-pointer w-full elevated"
    href={`/blog/${article.slug}`}>
		<div
			class="border-l-4 border-t-4 border-r-2 border-b-2 border-black min-h-[12rem] flex flex-col p-4 overflow-hidden">
          {article.data.image && (
            <div class="mb-4 overflow-hidden aspect-video">
              <img 
                src={article.data.image} 
                alt={article.data.title} 
                class="object-cover w-full h-full"
              />
            </div>
          )}
          
          <div class="flex items-center gap-2 mb-2">
            <span class={`text-xs font-normal px-2 py-1 rounded ${categoryColors[article.data.category]}`}>
              {article.data.category}
            </span>
            <time class="text-sm text-gray-600 font-normal">
              {article.data.date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
              })}
            </time>
          </div>
          
          <h2 class="text-2xl font-mono font-bold tracking-wide mb-2 group-hover:text-purple-600">
            {article.data.title}
          </h2>
          
          <p class="text-gray-600 font-medium text-sm line-clamp-3">
            {article.data.description}
          </p>
		</div>
	</a>
  </div>

      ))}
    </div>
    
    {sortedArticles.length === 0 && (
      <div class="text-center py-12">
        <p class="text-gray-500 font-mono">No articles published yet. Check back soon!</p>
      </div>
    )}
  </div>
</BlogLayout>
