<head>
    <title>Royaler SPH-Anmeldeservice</title>
</head>

<body>

    <h2>Hey! Gib hier deine Anmeldedaten für das Schulportal ein (Zur Zeit nur GMB).</h2>
    <h4>Sie werden lokal gespeichert und beim nächsten Aufrufen dieser Seite an das Schulportal übertragen. Füge zum
        Ändern ?change an die Adresse der Website an.</h4>
    <p>Man sehe den aktuellen Stand dieser Seite als proof of concept...</p>

    <hr/>

    <form>
        <label for="school">Schulnummer</label>
        <input type="text" id="school" name="user" value="5146" />
        <br/>
        <label for="user">Nutzername</label>
        <input type="text" id="user" name="user" value="" />
        <br/>
        <label for="password">Passwort</label>
        <input type="text" id="password" name="password" value="" />
        <br/>
        <button onclick="save()">Speichern</button>
    </form>

    <script>

        if (localStorage.getItem("user") != null && localStorage.getItem("password") != null && !window.location.href.includes("change")) {

            post('https://login.schulportal.hessen.de/?url=aHR0cHM6Ly9jb25uZWN0LnNjaHVscG9ydGFsLmhlc3Nlbi5kZS8=&skin=sp', { user: localStorage.getItem("school") + '.' + localStorage.getItem("user"), password: localStorage.getItem("password") })
            document.body.style.display = none;


            function post(url, formData) {
                const makeElem = (tag, props) => Object.assign(document.createElement(tag), props)
                const form = makeElem('form', { action: url, method: 'post', hidden: true })
                for (const [name, value] of Object.entries(formData)) {
                    form.appendChild(makeElem('input', { name, value }))
                }
                document.body.appendChild(form)
                form.submit()
            }
        }

        function save() {
            localStorage.setItem("school", document.getElementById("school").value)
            localStorage.setItem("user", document.getElementById("user").value)
            localStorage.setItem("password", document.getElementById("password").value)
        }


    </script>

</body>